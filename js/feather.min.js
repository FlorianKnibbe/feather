var Feather=function(){this.session={},this.get={},this.post={},this.config={},this.touchendEvent="ontouchend"in document?"vclick":"click";var fth=this,parameters={};this.init=function(e){var t={version:"0.5",asyncRessources:[],onArticleReady:function(){},ajaxCache:!1,defaultSection:'[data-role="feather"]>section:first',defaultArticle:'[data-role="feather"] section.active>article:first',configFile:"",onFeatherReady:function(){}};if(parameters=$.extend(t,e),""!=$.trim(parameters.configFile))try{$.post(parameters.configFile,{},function(e){fth.config=e},"json")}catch(a){return fth.pushError({methode:"init",message:"Impossible de charger le fichier de config suivant : "+parameters.configFile})}$.ajaxSetup({cache:parameters.ajaxCache});var r=0;$.each(parameters.asyncRessources,function(e,t){$.ajax({url:t,success:function(e){$('[data-role="feather"]').append(e)},error:function(){return fth.pushError({methode:"init",message:"Ressouce "+t+" impossible à charger"})}}).done(function(){r++,r>=parameters.asyncRessources.length&&(fth.goToSection(parameters.defaultSection,{onArticleReady:function(){fth.preloader.close(),parameters.onArticleReady()},defaultArticle:parameters.defaultArticle}),fth.initEventListener(),$('[data-role="feather"]').addClass("active"),parameters.onFeatherReady())})})},this.goToArticle=function(e,t){var e=$.trim(e),t=t||{},a=t.asyncArticle||"",r=t.onArticleReady||function(){},i=t.forceAsyncArticle||!1;if(fth.post=t.data||{},fth.get=fth.getToJson(e),!$.isEmptyObject(Feather.get)){var n=e.split("?");e=n[0]}i!==!1&&void 0!==i&&$(e).remove();var o=$(e);return fth.hideAsideMenu($('[data-role="feather"] section.active')),0==o.length&&""==a?fth.pushError({methode:"goToArticle",message:"Article à afficher introuvable"}):0!=o.length||""==a?o.length>0?fth.activeArticle(o,r):fth.pushError({methode:"goToArticle",message:"Erreur inconnue"}):void $.ajax({type:"GET",url:a,timeout:5e3,success:function(t){return $('[data-role="feather"] section.active').append(t),fth.fillTemplate(e),fth.activeArticle($(e),r)},error:function(){fth.pushError({methode:"goToArticle",message:"Erreur de chargement de la ressource asynchrone suivante : "+a})}})},this.activeArticle=function(e,t){var t=t||function(){};return 0==e.length?fth.pushError({methode:"activeArticle",message:"Article à activer introuvable"}):($('[data-role="feather"] section article.active').removeClass("active"),fth.activeNavForArticle(e),e.addClass("active"),t(),fth)},this.goToSection=function(e,t){var t=t||{},a=t.asyncSection||"",r=t.asyncArticle||"",i=t.defaultArticle||'[data-role="feather"] section.active>article:first',n=t.onArticleReady||function(){},e=$.trim(e),o=t.forceAsyncSection||!1,s=t.forceAsyncArticle||!1;o!==!1&&void 0!==o&&$(e).remove();var c=$(e);fth.hideAsideMenu($('[data-role="feather"] section.active')),setTimeout(function(){return 0==c.length&&""==a?fth.pushError({methode:"goToSection",message:"Section à afficher introuvable"}):0!=c.length||""==a?c.length>0?fth.activeSection(c).goToArticle(i,{onArticleReady:n,asyncArticle:r,forceAsyncArticle:s}):fth.pushError({methode:"goToSection",message:"Erreur inconnue"}):void $.ajax({type:"GET",url:a,timeout:5e3,success:function(t){return $('[data-role="feather"]').append(t),c=$(e),fth.activeSection(c).goToArticle(i,{onArticleReady:n,asyncArticle:r,forceAsyncArticle:s})},error:function(){fth.pushError({methode:"goToSection",message:"Erreur de chargement de la ressource asynchrone suivante : "+a})}})},500)},this.activeSection=function(e){return 0==$(e).length?fth.pushError({methode:"activeSection",message:"Section à activer introuvable"}):($('[data-role="feather"] section.active').removeClass("active"),$(e).addClass("active"),fth)},this.activeNavForArticle=function(e){var t=$(e).attr("id");$('[data-role="feather"] nav[data-role="groupBarTop"].active').removeClass("active"),$('[data-role="feather"] nav[data-role="groupBarBottom"].active').removeClass("active");var a=$('[data-role="feather"] section.active nav[data-for-articles~="#'+t+'"]');a.length>0&&(a.addClass("active"),a.find('a.active[data-view-article!="'+t+'"]').removeClass("active"),a.find('a[data-view-article="#'+t+'"]').addClass("active")),$('[data-role="feather"] aside [data-view-article],[data-role="feather"] aside [data-view-section]').removeClass("active");var r=$('[data-role="feather"] aside [data-view-article="#'+t+'"]');r.length<=0?$('[data-role="feather"] aside [data-default-article="#'+t+'"]').addClass("active"):r.addClass("active")},this.hideAsideMenu=function(e){e.removeClass("showAside")},this.showAsideMenu=function(e){e.addClass("showAside")},this.initEventListener=function(){$('[data-role="feather"]').on(fth.touchendEvent,"[data-view-aside]",function(e){e.preventDefault();var t=$(this).closest("section");t.hasClass("showAside")?fth.hideAsideMenu(t):fth.showAsideMenu(t)}),$('[data-role="feather"]').on(fth.touchendEvent,"[data-view-article]",function(e){e.preventDefault();var t=$(this).attr("data-force-async-article");"undefined"!=typeof t&&t!==!1&&0!==t&&(t=!0);var a=$(this).attr("data-validPost"),r=$(this).attr("data-sendPost"),i={};if("undefined"!=typeof r&&r!==!1&&(i=fth.postToJson(r)),"undefined"!=typeof a&&a!==!1&&"undefined"!=typeof r&&r!==!1){var n=fth.validPost($(this).attr("data-sendPost"));if("ko"==n.etat)return void fth.alert(fth.showErr(n.message))}fth.goToArticle($(this).attr("data-view-article"),{asyncArticle:$(this).attr("data-async-article"),data:i,forceAsyncArticle:t})}),$('[data-role="feather"]').on(fth.touchendEvent,"[data-view-section]",function(e){e.preventDefault();var t=$(this).attr("data-force-async-section");"undefined"!=typeof t&&t!==!1&&0!==t&&(t=!0);var a=$(this).attr("data-force-async-article");"undefined"!=typeof a&&a!==!1&&0!==a&&(a=!0),fth.goToSection($(this).attr("data-view-section"),{defaultArticle:$(this).attr("data-default-article"),asyncSection:$(this).attr("data-async-section"),asyncArticle:$(this).attr("data-async-article"),forceAsyncSection:t,forceAsyncArticle:a,data:$(this).attr("data-sendPost")})}),$(document).on("swiperight","section.active.showAsideOnSwipe:not(.showAside)",function(e,t){Number(t.startEvnt.position.x)<0||Number(t.startEvnt.position.x)>50||Feather.showAsideMenu($(this))}),$(document).on("swipeleft","section.active.showAside.showAsideOnSwipe",function(e,t){var a=Number($("section.showAside").width()),r=Number(a-50);Number(t.startEvnt.position.x)>a||Number(t.startEvnt.position.x)<r||Feather.hideAsideMenu($(this))})},this.loader=function(e,t){var t=t||'<div><p><span class="icon-spinner margin-right rotate"></span>Traitement en cours...</p></div>';"open"==e?$('[data-role="feather"]').append('<div id="_featherLoader"><div id="_featherLoaderContent">'+t+"</div></div>"):$("#_featherLoader").remove()},this.alert=function(e,t){var e=e||"",t=t||{},a=t.onExit||function(){},r=t.txtBtnClose||"Fermer";$('[data-role="feather"]').append('<div id="_featherAlert"><div id="_featherAlertContent" class="bck-white"><div class="padding">'+e+'</div><div id="_featherAlertButtons" class="padding text right"><button type="button" class="theme" id="_featherAlertButtonClose">'+r+"</button></div></div></div>"),$("#_featherAlert #_featherAlertButtonClose").on(fth.touchendEvent,function(e){e.preventDefault(),$("#_featherAlert").remove(),$("#_featherAlert #_featherAlertButtonClose").off(fth.touchendEvent),a()})},this.confirm=function(e,t){var e=e||"",t=t||{},a=t.onYes||function(){},r=t.onNo||function(){},i=t.txtBtnYes||"Oui",n=t.txtBtnNo||"Non",o="",s=" margin-left";$(window).width()<500&&(o=" fullWidth margin-bottom",s=" fullWidth"),$('[data-role="feather"]').append('<div id="_featherConfirm"><div id="_featherConfirmContent" class="bck-white"><div class="padding">'+e+'</div><div id="_featherConfirmButtons" class="padding text right"><button type="button" class="theme'+o+'" id="_featherConfirmButtonYes">'+i+'</button><button type="button" class="theme'+s+'" id="_featherConfirmButtonNo">'+n+"</button></div></div></div>"),$("#_featherConfirm #_featherConfirmButtonYes").on(fth.touchendEvent,function(e){e.preventDefault(),$("#_featherConfirm").remove(),$("#_featherConfirm #_featherConfirmButtonYes").off(fth.touchendEvent),a()}),$("#_featherConfirm #_featherConfirmButtonNo").on(fth.touchendEvent,function(e){e.preventDefault(),$("#_featherConfirm").remove(),$("#_featherConfirm #_featherConfirmButtonNo").off(fth.touchendEvent),r()})},this.dialog={open:function(e){var e=e||"";$('[data-role="feather"]').append('<div id="_featherDialog"><div id="_featherDialogContent" class="bck-white">'+e+"</div>")},close:function(){$("#_featherDialog").remove()}},this.preloader={open:function(){$('[data-role="preloader"]').removeClass("hide")},close:function(){$('[data-role="preloader"]').addClass("hide")}},this.pushError=function(e){return alert(" ERROR : "+e.methode+" -> "+e.message),!1},this.preparePost=function(e,t){var e=e||"",t=t||{};if(""==e)var a=[];else{_jqtmp2=$(e).filter("input[type=hidden]"),_jqtmp=$(e).filter(":input").filter(":enabled").add(_jqtmp2),_jqtmp3=$(e).find("*").filter("input[type=hidden]");var a=$(e).find("*").filter(":input").filter(":enabled").add(_jqtmp3).add(_jqtmp).serializeArray()}var r=new Array,n=0;for(i in t)if($.isArray(t[i]))for(k in t[i])r[n]={name:i+"[]",value:t[i][k]},n+=1;else r[n]={name:i,value:t[i]},n+=1;return $.merge(a,r),a},this.postToJson=function(e,t){var e=e||"",t=t||{},a=fth.preparePost(e,t),r={};return $.each(a,function(e,t){var a=new RegExp("\\[.+\\]","ig"),i=new RegExp("\\[\\]","ig");if(a.test(t.name)){var n=t.name.substring(t.name.lastIndexOf("[")+1,t.name.lastIndexOf("]")).toString();("object"!=typeof r[t.name.replace(a,"")]||null===r[t.name.replace(a,"")])&&(r[t.name.replace(a,"")]={}),r[t.name.replace(a,"")][n]=t.value}else i.test(t.name)?(t.name=t.name.replace(i,""),$.isArray(r[t.name])||(r[t.name]=[]),r[t.name].push(t.value)):r[t.name]=t.value}),r},this.validPost=function(e){var t,a=$(e).find("input:enabled, select:enabled, textarea:enabled"),r={},i=!0;return a.each(function(){var e=$(this).attr("data-required"),a=$(this).attr("title"),r=$(this).attr("name");if(t="undefined"!=typeof a&&a!==!1?$(this).attr("title"):"Le champ "+r+" est invalide","undefined"!=typeof e&&e!==!1){var n=new RegExp("\\[.*\\]","ig");if(n.test(r)){var o=r.replace(n,"");if("+"==e){if(Number($('[name^="'+o+'"]:checked').length)<=0)return i=!1,!1}else if("1"==e){if("1"!=$('[name^="'+o+'"]:checked').length)return i=!1,!1}else if(isNaN(e)){var s=new RegExp("[0-9]+\\+","ig");if(1==s.test(e)&&(e=Number(e.replace("+","")),Number($('[name^="'+o+'"]:checked').length)<e))return i=!1,!1}else if(Number($('[name^="'+o+'"]:checked').length)!=Number(e))return i=!1,!1}}else if($(this)[0].checkValidity()===!1)return i=!1,!1}),r=i===!0?{etat:"ok"}:{etat:"ko",message:""+t}},this.getToJson=function(e){var t={};if(""==e)return t;var a=e.split("?");if(a.length<=1||a.length>2)return t;for(var r=a[1].split("&"),i=0;i<r.length;++i){var n=r[i].split("=",2);t[n[0]]=1==n.length?"":decodeURIComponent(n[1].replace(/\+/g," "))}return t},this.fillTemplate=function(selector){var myHtml=$(selector).html(),keys=myHtml.match(/{{.*}}/g);if(null!=keys&&keys.length>0){for(var i=0;i<keys.length;i++){var subName=keys[i].replace("{{","").replace("}}",""),val;try{val=eval(subName)}catch(e){val=""}val=val||"",myHtml=myHtml.replace(keys[i],val)}$(selector).html(myHtml)}},this.objectLength=function(e){return Object.keys(e).length},this.showInfo=function(e,t){var t=t||{},a=t.title||"Information",r=t.id||"";return"<div id='"+r+"' class='podShowInfo'><span class='icon-info-circle'></span><p><strong class='title'>"+a+" :</strong><br/>"+e+"</p></div>"},this.showWarn=function(e,t){var t=t||{},a=t.title||"Attention",r=t.id||"";return"<div id='"+r+"' class='podShowWarn'><span class='icon-exclamation-triangle'></span><p><strong class='title'>"+a+" :</strong><br/>"+e+"</p></div>"},this.showErr=function(e,t){var t=t||{},a=t.title||"Erreur",r=t.id||"";return"<div id='"+r+"' class='podShowErr'><span class='icon-times-circle'></span><p><strong class='title'>"+a+" :</strong><br/>"+e+"</p></div>"},this.showConf=function(e,t){var t=t||{},a=t.title||"Confirmation",r=t.id||"";return"<div id='"+r+"' class='podShowConf'><span class='icon-check-circle'></span><p><strong class='title'>"+a+" :</strong><br/>"+e+"</p></div>"}},Feather=new Feather;